#!/usr/bin/python
# -*- coding: UTF-8 -*-
#
#########################################################
# Name: audiomass (main script)
# Porpose:  launch audiomass script for command line interface
# Writer: Gianluca Pernigoto <jeanlucperni@gmail.com>
# Copyright: (c) 2015/2016 Gianluca Pernigoto <jeanlucperni@gmail.com>
# license: GPL3
# Version: (Ver.0.6) Febbruary 2015
# Rev
#########################################################

import sys
import os
from admspack.datastrings import info
from admspack.get_file import file_
from admspack.get_directory import dir_
from admspack.get_batch import batch_

cr = info()
AUTHOR = cr[0]
MAIL = cr[1]
COPYRIGHT = cr[2]
VERSION = cr[3]
RELEASE = cr[4]
RLS_NAME = cr[5]# release name first letter is Uppercase
PRG_NAME = cr[6]
URL = cr[7]
DECRIPTION = cr[8]
LONG_DESRIPTION = cr[9]
LONG_HELP = cr[10]
LICENSE = cr[11]# long_license
TRY = cr[13]

file_access = "\033[33;1mWarning:\033[0m\033[1m Unable to access, invalid file name  >\033[0m" 
dir_access = "\033[31;1mError:\033[0m\033[1m Unable to access, Invalid dir. name  >\033[0m"

print "\n\033[1m%s\033[0m - front-end wrapper audio converter -\n" % (RLS_NAME)

def main():
  """
  Verify the arguments passed on the command line interface.
  """
  if '-d' in sys.argv or '--dir' in sys.argv:
    try:
      if os.path.isdir(sys.argv[2]): 
        path_in = sys.argv[2] # this is a dir-name (if not empty)
      else:
        sys.exit("%s %s"%(dir_access ,sys.argv[2]))
    except IndexError:
        #path_in = os.getcwd() # if no dir-name use current work directory
        sys.exit("Missing argument\n%s" % TRY)

    dir_(path_in)
    
  elif '-b' in sys.argv or '--batch' in sys.argv:
    list_ = []
    notFile = []

    for f in sys.argv[2:]:# itero dal 2Â° arg. lista
      if os.path.isfile(f): # must be file only here
        list_.append(f)
      else:
        notFile.append(f)
        print "%s %s" % (file_access, f)
    for i in list_:# rimuovo doppioni accidentali.
      if list_.count(i) > 1:
        print "\n\033[1mRemoving following duplicates: >\033[0m '%s' >" % i

    list_ = list(set(list_)) # elimino i doppioni
    batch_(list_)
        
    #if notFile is not None:
      #print list_
      #sys.exit("Warning: i seguenti Missing argument\nTry: audiomass-cli --help")
    #print notFile
    #print list_

  elif '-f' in sys.argv or '--file' in sys.argv: 
    try:
      if os.path.isfile(sys.argv[2]): # must be file only here
        path_in = sys.argv[2] # is a file-name
      else:
        sys.exit("%s %s" % (file_access, sys.argv[2]))
        
    except IndexError:
      sys.exit("Missing argument\n%s" % TRY)
      
    # input_format is the extension format of path_in
    input_format = os.path.splitext(path_in)[1].replace(".","")
    
    file_(input_format, path_in)
      
  elif '-v' in sys.argv or '--version' in sys.argv:
    print "%s - %s" % (VERSION, RELEASE) 
    return
      
  elif '-h' in sys.argv or '--help' in sys.argv:
    print LONG_HELP
    return
      
  elif '-c' in sys.argv or '--copying' in sys.argv:
    print LICENSE
    return
  
  else:
    sys.exit("Missing options\n%s" % TRY)
  
  return 0

if __name__ == '__main__':
    status = main()
    sys.exit(status)
